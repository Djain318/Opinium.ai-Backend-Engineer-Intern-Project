# Data Transformation Pipeline

## üöÄ Deployment

**Live API Base URL:** [https://opinium-ai-backend-engineer-intern.onrender.com/](https://opinium-ai-backend-engineer-intern.onrender.com/)

## üöÄ Overview

This project implements a data transformation pipeline that fetches raw event data from multiple public APIs, normalizes and enriches it using business rules, and provides an API to query the processed data.

## üöÄ Features

- Fetches data from three public sources:
  - E-commerce product data
  - User data
  - Transaction/order data
- Transforms and normalizes data into a unified format.
- Applies business rules:
  - Joins transaction data with product data to include product details.
  - Joins transaction data with user data for complete purchase records.
  - Calculates total spending per user.
  - Identifies the most popular product categories.
  - Computes the average transaction value.
- Provides FastAPI-based endpoints for querying processed data.

## üöÄ Data Sources

The following public APIs are used:

**1Ô∏è‚É£ Products API**: [FakeStoreAPI](https://fakestoreapi.com/products)

- Endpoint: `https://fakestoreapi.com/products`
- Represents the product catalog.

**2Ô∏è‚É£ Users API**: [RandomUser API](https://randomuser.me/api/?results=20)

- Endpoint: `https://randomuser.me/api/?results=20`
- Represents user profiles.

**3Ô∏è‚É£ Transactions API**: [Mockaroo API](https://my.api.mockaroo.com/orders.json?key=e49e6840)

- Endpoint: `https://my.api.mockaroo.com/orders.json?key=e49e6840`
- Represents purchase transactions.

## üöÄ Data Transformation

All fetched data is transformed into the following standardized format:

```json
{
    "entity_id": "generated-unique-id",
    "entity_type": "product|user|transaction",
    "timestamp": "ISO-8601-format",
    "data": {
      "//Normalized fields from the source"
    },
    "metadata": {
        "source": "which API",
        "processed_at": "processing timestamp"
    }
}
```

## üöÄ API Endpoints

### **1Ô∏è‚É£ Retrieve Processed Data**

```http
GET /data/{entity_type}
```

- Fetches processed data based on entity type (`product`, `user`, or `transaction`).
- Hosted API Endpoint:
  [https://opinium-ai-backend-engineer-intern.onrender.com/data/{entity\_type}](https://opinium-ai-backend-engineer-intern.onrender.com/data/{entity_type})

### **2Ô∏è‚É£ User Spending Insights**

```http
GET /insights/users
```

- Returns total spending per user.
- Hosted API Endpoint:
  [https://opinium-ai-backend-engineer-intern.onrender.com/insights/users](https://opinium-ai-backend-engineer-intern.onrender.com/insights/users)

### **3Ô∏è‚É£ Product Popularity Insights**

```http
GET /insights/products
```

- Identifies the most popular product categories.
- Hosted API Endpoint:
  [https://opinium-ai-backend-engineer-intern.onrender.com/insights/products](https://opinium-ai-backend-engineer-intern.onrender.com/insights/products)

### **4Ô∏è‚É£ Test the Endpoints Using Swagger UI**

FastAPI provides an interactive API documentation using Swagger UI. Once the server is running:

- Open your browser and go to: `http://127.0.0.1:8000/docs`
- You can interact with all the API endpoints directly from this interface.

Alternatively, you can use Redoc:

- Open `http://127.0.0.1:8000/redoc`

#### Swagger UI Preview

## üöÄ Project Setup Instructions

### **1Ô∏è‚É£ Clone the Repository**

```sh
git clone https://github.com/Djain318/Opinium.ai-Backend-Engineer-Intern-Project.git
cd Opinium.ai-Backend-Engineer-Intern-Project
```

### **2Ô∏è‚É£ Create a Virtual Environment**

```sh
python -m venv .venv
```

On Windows:

```sh
.venv\Scripts\activate
```

On macOS/Linux:

```sh
source .venv/bin/activate
```

### **3Ô∏è‚É£ Install Dependencies**

```sh
pip install -r requirements.txt
```

### **4Ô∏è‚É£ Run the Application**

```sh
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```
### **How I approach to solve the Problem ?**  

I started by understanding the requirements, which involved building a FastAPI backend that fetches data from multiple APIs, processes it, and provides insights on users, transactions, and products. 
- For data fetching and transformation, I used `requests` to get data from external APIs and applied a decorator (`transform_response`) to standardize the format, adding metadata and timestamps.  
- To process the data efficiently, I created lookup dictionaries for users and products, then enriched transactions by merging them with relevant details.  
- For insights, I calculated total spending per user, identified the most popular product category, and computed the average transaction value.  
- FastAPI endpoints were set up to fetch raw data (`/data/{entity_type}`) and provide insights on user spending (`/insights/user`) and popular product categories (`/insights/product`).  
- To optimize performance, I made fetched data global to avoid redundant API calls. Debugging included fixing issues like `AttributeError: 'tuple' object has no attribute 'get'` by ensuring correct data structures.  

Finally, for deployment, I considered Render.
